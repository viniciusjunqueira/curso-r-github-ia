---
title: "Introdu√ß√£o Programa√ß√£o em R com GitHub, ChatGPT e Claude"
# subtitle: "Integra√ß√£o do ChatGPT e Claude no RStudio"
author: "Vin√≠cius Silva Junqueira"
date: "`r Sys.Date()`"
output: 
  pdf_document:
    latex_engine: xelatex
    toc: true
    toc_depth: 2
    number_sections: true
lang: pt-BR
fontsize: 11pt
geometry: margin=2.5cm
header-includes:
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  - \fancyhead[L]{\small Vin√≠cius Silva Junqueira}
  - \fancyhead[R]{\small \thepage}
  - \fancyfoot[L]{\small Curso R + GitHub + IA}
  - \fancyfoot[R]{\small junqueiravinicius@hotmail.com}
  - \renewcommand{\headrulewidth}{0.4pt}
  - \renewcommand{\footrulewidth}{0.4pt}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  eval = FALSE,
  warning = FALSE,
  message = FALSE,
  error = FALSE,
  comment = "#>"
)
```

# Dia 4 ‚Äî Integra√ß√£o do ChatGPT e Claude no RStudio

> **Objetivo do dia**
>
> Capacitar voc√™ a usar ChatGPT (OpenAI) e Claude (Anthropic) diretamente no RStudio para:
> - Explicar erros e debugar c√≥digo
> - Revisar e refatorar c√≥digo
> - Gerar c√≥digo e fun√ß√µes
> - Criar rascunhos de relat√≥rios e documenta√ß√£o
> - Automatizar tarefas via API

**Tempo previsto:** 19h00‚Äì22h00 (intervalo 20h15‚Äì20h30)

---

## Revis√£o R√°pida dos Dias Anteriores (‚âà 10 min)

```{r revisao}
library(tidyverse)

# Dia 1: Fundamentos
vetor <- c(1, 2, 3, 4, 5)
mean(vetor)

# Dia 2: Fun√ß√µes e tidyverse
calcular_media <- function(x) {
  mean(x, na.rm = TRUE)
}

dados <- tibble(x = 1:10, y = x^2)

# Dia 3: Transforma√ß√£o e visualiza√ß√£o
dados %>%
  mutate(z = x + y) %>%
  ggplot(aes(x, y)) +
  geom_point()
```

---

# Parte 1: Conceitos e Modelos (19h00 - 19h30)

## 1.1 O que s√£o LLMs (Large Language Models)?

**LLM = Large Language Model** (Modelo de Linguagem Grande)

**O que s√£o:**
- Modelos de intelig√™ncia artificial treinados em volumes massivos de texto
- Aprendem padr√µes da linguagem, conceitos e rela√ß√µes
- Capazes de gerar texto, c√≥digo, explica√ß√µes e muito mais

**Como funcionam (simplificado):**
1. **Treinamento**: Leem bilh√µes de p√°ginas de texto da internet, livros, c√≥digo
2. **Aprendizado**: Identificam padr√µes - como palavras se relacionam, estruturas de c√≥digo
3. **Gera√ß√£o**: Preveem a pr√≥xima palavra/token mais prov√°vel dada uma entrada

**N√£o s√£o:**
- ‚ùå Bancos de dados que "buscam" respostas
- ‚ùå Sistemas de busca como Google
- ‚ùå Calculadoras ou compiladores

**S√£o:**
- ‚úÖ Sistemas de reconhecimento de padr√µes estat√≠sticos
- ‚úÖ Geradores de texto coerente baseados em probabilidades
- ‚úÖ Assistentes que "entendem" contexto

### Modelos principais que usaremos

**1. ChatGPT (OpenAI)**

**Fam√≠lia GPT-4:**
- `gpt-4o`: Mais r√°pido e barato, multimodal (texto + imagem)
- `gpt-4o-mini`: Ainda mais r√°pido e barato, excelente custo-benef√≠cio
- `gpt-4-turbo`: Balanceado entre velocidade e qualidade

**Pontos fortes:**
- ‚úÖ Explica√ß√µes did√°ticas e passo a passo
- ‚úÖ Gera√ß√£o r√°pida de c√≥digo
- ‚úÖ Bom em tarefas criativas
- ‚úÖ Interface conversacional natural
- ‚úÖ Mais barato que Claude

**Quando usar:**
- Explicar conceitos de forma simples
- Gerar c√≥digo rapidamente (prot√≥tipos)
- Criar documenta√ß√£o b√°sica
- Responder d√∫vidas gerais

**2. Claude (Anthropic)**

**Fam√≠lia Claude 3:**
- `claude-3-5-sonnet-latest`: Melhor modelo, mais inteligente
- `claude-3-opus`: Mais preciso, melhor para an√°lises complexas
- `claude-3-sonnet`: Balanceado
- `claude-3-haiku`: Mais r√°pido e barato

**Pontos fortes:**
- ‚úÖ An√°lise profunda de c√≥digo
- ‚úÖ Respostas mais longas e detalhadas
- ‚úÖ Melhor em racioc√≠nio complexo
- ‚úÖ Mais cuidadoso e preciso
- ‚úÖ Melhor contexto (200k tokens vs 128k do GPT)

**Quando usar:**
- Revisar c√≥digo complexo
- An√°lise e refatora√ß√£o profunda
- Explica√ß√µes t√©cnicas detalhadas
- Debugging de problemas dif√≠ceis

### Compara√ß√£o pr√°tica

| Crit√©rio | ChatGPT | Claude |
|----------|---------|--------|
| **Velocidade** | Muito r√°pido ‚ö°‚ö°‚ö° | R√°pido ‚ö°‚ö° |
| **Custo** | Mais barato üí∞ | Mais caro üí∞üí∞ |
| **Explica√ß√µes simples** | Excelente ‚≠ê‚≠ê‚≠ê | Muito bom ‚≠ê‚≠ê |
| **An√°lise profunda** | Bom ‚≠ê‚≠ê | Excelente ‚≠ê‚≠ê‚≠ê |
| **C√≥digo complexo** | Bom ‚≠ê‚≠ê | Excelente ‚≠ê‚≠ê‚≠ê |
| **Contexto (tokens)** | 128k | 200k |
| **Criatividade** | Alta ‚≠ê‚≠ê‚≠ê | Moderada ‚≠ê‚≠ê |
| **Precis√£o t√©cnica** | Boa ‚≠ê‚≠ê | Excelente ‚≠ê‚≠ê‚≠ê |

---

## 1.2 O que s√£o APIs?

**API = Application Programming Interface** (Interface de Programa√ß√£o de Aplica√ß√µes)

**Analogia do restaurante:**
- **Voc√™** = seu c√≥digo R
- **Cozinha** = servidor da OpenAI/Anthropic com o modelo de IA
- **Gar√ßom** = API que leva seu pedido e traz a resposta
- **Card√°pio** = documenta√ß√£o da API (o que voc√™ pode pedir)

**Como funciona:**

1. **Voc√™ faz uma requisi√ß√£o** (pergunta)
   ```
   "Explique o que este c√≥digo faz: x <- mean(1:10)"
   ```

2. **API envia para o modelo de IA**
   - Viaja pela internet at√© os servidores
   - Processa sua pergunta

3. **Modelo gera resposta**
   - Analisa contexto
   - Gera texto/c√≥digo

4. **API retorna resposta**
   ```
   "Este c√≥digo calcula a m√©dia dos n√∫meros de 1 a 10..."
   ```

**Componentes de uma API:**

- **Endpoint**: URL para onde enviar requisi√ß√µes
  - OpenAI: `https://api.openai.com/v1/chat/completions`
  - Anthropic: `https://api.anthropic.com/v1/messages`

- **M√©todo HTTP**: Como enviar (GET, POST, etc.)
  - Usaremos POST (enviar dados)

- **Headers**: Informa√ß√µes sobre a requisi√ß√£o
  - Authorization: sua chave API
  - Content-Type: formato dos dados (JSON)

- **Body**: Os dados da requisi√ß√£o
  - Modelo a usar
  - Sua pergunta/prompt
  - Par√¢metros (temperatura, max_tokens, etc.)

- **Response**: A resposta do servidor
  - Conte√∫do gerado
  - Metadados (tokens usados, etc.)

---

## 1.3 Limites e Custos

### Custos por modelo

**OpenAI (GPT-4o-mini) - mais barato:**
- Input: $0.150 / 1M tokens (~750k palavras)
- Output: $0.600 / 1M tokens

**Exemplo pr√°tico:**
- 1 conversa t√≠pica = ~1000 tokens = $0.0015 (menos de 1 centavo!)
- 1000 conversas = ~$1.50

**Anthropic (Claude 3.5 Sonnet) - mais caro mas melhor:**
- Input: $3.00 / 1M tokens
- Output: $15.00 / 1M tokens

**Exemplo pr√°tico:**
- 1 conversa t√≠pica = ~1000 tokens = $0.03 (3 centavos)
- 1000 conversas = ~$30

**O que √© um token?**
- Token ‚âà 0.75 palavras em ingl√™s
- Token ‚âà 0.5 palavras em portugu√™s (devido aos acentos)
- "Ol√°, como voc√™ est√°?" ‚âà 7-8 tokens

### Rate Limits (Limites de taxa)

**Por que existem:**
- Prevenir abuso e spam
- Garantir disponibilidade para todos
- Controlar custos

**Limites t√≠picos (conta gratuita/tier 1):**

**OpenAI:**
- ~10,000 tokens/minuto
- ~3 requisi√ß√µes/minuto (com GPT-4)
- ~200 requisi√ß√µes/dia

**Anthropic:**
- ~10,000 tokens/minuto
- ~5 requisi√ß√µes/minuto
- ~1000 requisi√ß√µes/dia

**O que acontece se exceder:**
- Erro HTTP 429: "Too Many Requests"
- Precisa esperar (geralmente 1 minuto)

**Como evitar:**
- N√£o fa√ßa loops r√°pidos com chamadas √† API
- Implemente delays entre requisi√ß√µes
- Use um modelo mais barato para testes

---

## 1.4 Boas Pr√°ticas de Uso Respons√°vel de IA

### Privacidade e Dados Sens√≠veis

**‚ö†Ô∏è NUNCA envie para APIs de IA:**
- ‚ùå Senhas ou credenciais
- ‚ùå Dados pessoais identific√°veis (CPF, RG, etc.)
- ‚ùå Informa√ß√µes m√©dicas ou financeiras privadas
- ‚ùå Dados propriet√°rios ou confidenciais da empresa
- ‚ùå C√≥digo com chaves de API ou tokens

**O que √© seguro enviar:**
- ‚úÖ C√≥digo gen√©rico e exemplos
- ‚úÖ Dados p√∫blicos ou sint√©ticos
- ‚úÖ Perguntas conceituais
- ‚úÖ Erros e stacktraces (sem informa√ß√£o sens√≠vel)

**Lembre-se:** Tudo que voc√™ envia pode ser usado para treinar modelos futuros!

### Versionamento de C√≥digo Gerado por IA

**Por que versionar:**
- Transpar√™ncia sobre origem do c√≥digo
- Rastreabilidade de mudan√ßas
- Facilita debugging futuro
- √âtica e honestidade acad√™mica/profissional

**Como fazer:**

```r
# Bom: documenta que IA gerou
# Esta fun√ß√£o foi gerada por ChatGPT em 2024-11-25
# Prompt: "Crie fun√ß√£o para calcular z-score"
zscore <- function(x) {
  (x - mean(x, na.rm = TRUE)) / sd(x, na.rm = TRUE)
}

# Commits descritivos
git commit -m "feat: adiciona fun√ß√£o zscore (gerada com ChatGPT)"
```

### Valida√ß√£o e Teste

**‚ö†Ô∏è CR√çTICO: NUNCA use c√≥digo de IA sem entender e testar!**

**Processo recomendado:**

1. **Entenda** o c√≥digo gerado
   - Leia linha por linha
   - Pergunte √† IA se n√£o entender algo
   - Pesquise fun√ß√µes desconhecidas

2. **Teste** extensivamente
   ```r
   # Sempre teste casos extremos
   zscore(c(1, 2, 3))        # Normal
   zscore(c(1, 1, 1))        # Todos iguais (sd = 0?)
   zscore(c(1, NA, 3))       # Com NA
   zscore(numeric(0))        # Vetor vazio
   ```

3. **Valide** resultados
   - Compare com m√©todos conhecidos
   - Verifique casos conhecidos
   - Use diferentes inputs

4. **Refatore** se necess√°rio
   - Melhore legibilidade
   - Adicione valida√ß√µes
   - Otimize performance

### Uso √âtico

**Fa√ßa:**
- ‚úÖ Use IA como assistente, n√£o substituto do aprendizado
- ‚úÖ Entenda o que a IA est√° fazendo
- ‚úÖ Cite quando c√≥digo foi gerado por IA (contextos acad√™micos)
- ‚úÖ Revise e melhore c√≥digo gerado
- ‚úÖ Use para aprender conceitos novos

**N√£o fa√ßa:**
- ‚ùå Submeta c√≥digo de IA sem entender (em trabalhos/provas)
- ‚ùå Confie cegamente nas respostas
- ‚ùå Use como substituto de documenta√ß√£o oficial
- ‚ùå Compartilhe chaves de API
- ‚ùå Use para gerar trabalhos acad√™micos inteiros sem transpar√™ncia

---

# Parte 2: Configura√ß√£o de Chaves e Ambiente (19h30 - 20h15)

## 2.1 Vari√°veis de Ambiente no R

**O que s√£o vari√°veis de ambiente?**

Vari√°veis de ambiente s√£o configura√ß√µes que ficam armazenadas fora do seu c√≥digo, dispon√≠veis para todos os programas no seu sistema operacional.

**Por que usar para chaves de API?**

**Seguran√ßa:**
- ‚úÖ Chaves n√£o ficam no c√≥digo (evita commit acidental para GitHub)
- ‚úÖ Diferentes chaves para diferentes ambientes (dev, prod)
- ‚úÖ F√°cil rota√ß√£o de chaves sem mudar c√≥digo

**Como funcionam no R:**

```r
# Ler vari√°vel de ambiente
Sys.getenv("NOME_DA_VARIAVEL")

# Definir vari√°vel (apenas na sess√£o atual)
Sys.setenv(NOME_DA_VARIAVEL = "valor")

# Listar todas
Sys.getenv()
```

### O arquivo .Renviron

**O que √© .Renviron:**
- Arquivo de texto simples que define vari√°veis de ambiente
- Carregado automaticamente quando R inicia
- Localiza√ß√£o: diret√≥rio home do usu√°rio (`~/.Renviron`)

**Vantagens:**
- Vari√°veis persistem entre sess√µes
- N√£o precisa redefinir toda vez
- F√°cil de gerenciar

**Como criar/editar:**

```r
# Abrir .Renviron no RStudio (cria se n√£o existir)
usethis::edit_r_environ()

# Ou manualmente encontrar localiza√ß√£o
path.expand("~/.Renviron")
```

**Formato do arquivo:**

```
# Arquivo .Renviron
# Linhas come√ßando com # s√£o coment√°rios
# Formato: VARIAVEL=valor (SEM espa√ßos ao redor do =)

OPENAI_API_KEY=sk-proj-abcdefg123456789
ANTHROPIC_API_KEY=sk-ant-abcdefg123456789

# ERRADO (com espa√ßos):
# VARIAVEL = valor

# CERTO (sem espa√ßos):
# VARIAVEL=valor
```

**Depois de editar:**
1. Salve o arquivo
2. Reinicie o R: `Session ‚Üí Restart R` ou `.rs.restartR()`
3. Teste: `Sys.getenv("OPENAI_API_KEY")`

---

## 2.2 Criando Chaves de API

### OpenAI (ChatGPT)

**Passo 1: Criar conta**
1. Acesse https://platform.openai.com/
2. Sign up (criar conta) ou Login
3. Verifique email

**Passo 2: Adicionar m√©todo de pagamento**
1. Settings ‚Üí Billing
2. Add payment method
3. **Importante:** Configure um limite de gastos!
   - Recommended: $5-10/m√™s para aprendizado
   - Evita surpresas na fatura

**Passo 3: Criar API Key**
1. Settings ‚Üí API Keys
2. Create new secret key
3. D√™ um nome descritivo: "RStudio - Curso R"
4. **‚ö†Ô∏è COPIE A CHAVE AGORA!** (s√≥ aparece uma vez)
   - Formato: `sk-proj-...`
   - Guarde em local seguro temporariamente

**Passo 4: Configurar no R**
```r
usethis::edit_r_environ()
# Adicione: OPENAI_API_KEY=sk-proj-SUA_CHAVE_AQUI
# Salve e reinicie R
```

**Passo 5: Testar**
```r
Sys.getenv("OPENAI_API_KEY")
# Deve mostrar: "sk-proj-..."
```

### Anthropic (Claude)

**Passo 1: Criar conta**
1. Acesse https://console.anthropic.com/
2. Sign up ou Login
3. Verifique email

**Passo 2: Obter cr√©ditos**
- Contas novas ganham alguns cr√©ditos gratuitos ($5-10)
- Depois precisa adicionar m√©todo de pagamento

**Passo 3: Criar API Key**
1. Settings ‚Üí API Keys
2. Create Key
3. Nome: "RStudio - Curso R"
4. **‚ö†Ô∏è COPIE A CHAVE!** (s√≥ aparece uma vez)
   - Formato: `sk-ant-...`

**Passo 4: Configurar no R**
```r
usethis::edit_r_environ()
# Adicione: ANTHROPIC_API_KEY=sk-ant-SUA_CHAVE_AQUI
# Salve e reinicie R
```

**Passo 5: Testar**
```r
Sys.getenv("ANTHROPIC_API_KEY")
# Deve mostrar: "sk-ant-..."
```

---

## 2.3 Instala√ß√£o de Pacotes

```r
# Pacotes necess√°rios
install.packages(c(
  "gptstudio",    # Interface para ChatGPT no RStudio
  "chattr",       # Interface para m√∫ltiplos LLMs (incluindo Claude)
  "httr2",        # Cliente HTTP moderno (para APIs)
  "jsonlite"      # Trabalhar com JSON
))

# Verificar instala√ß√£o
library(gptstudio)
library(chattr)
library(httr2)
library(jsonlite)
```

### O que cada pacote faz

**gptstudio:**
- Addins no RStudio para ChatGPT
- Chat panel integrado
- Sele√ß√£o de c√≥digo + an√°lise
- Gera√ß√£o de documenta√ß√£o
- Corre√ß√£o de erros

**chattr:**
- Interface unificada para m√∫ltiplos LLMs
- Suporta OpenAI, Anthropic, Google, outros
- Chat interativo no console
- Configura√ß√£o flex√≠vel de modelos

**httr2:**
- Cliente HTTP moderno para R
- Fazer requisi√ß√µes para APIs
- Melhor que httr (vers√£o anterior)
- Pipe-friendly (`|>`)

**jsonlite:**
- Converter entre R e JSON
- APIs usam JSON para comunica√ß√£o
- Parse de respostas JSON

---

# INTERVALO (20h15 - 20h30)

Aproveite para:
- Verificar se suas chaves est√£o configuradas
- Instalar os pacotes
- Testar conex√£o com internet
- Tomar √°gua/caf√©!

---

# Parte 3: RStudio + gptstudio (ChatGPT) (20h30 - 21h00)

## 3.1 Conhecendo o gptstudio

**gptstudio** adiciona superpoderes de IA ao RStudio atrav√©s de Addins.

**Recursos principais:**
1. **ChatGPT Chat**: Painel de chat lateral
2. **Comment Code**: Adiciona coment√°rios ao c√≥digo
3. **Explain Code**: Explica c√≥digo selecionado
4. **Write Code**: Gera c√≥digo a partir de descri√ß√£o
5. **Edit Code**: Refatora/melhora c√≥digo

### Acessando os Addins

**Menu:** `Addins ‚Üí GPTSTUDIO ‚Üí ...`

**Atalhos de teclado (configur√°veis):**
- Tools ‚Üí Modify Keyboard Shortcuts
- Busque "GPTSTUDIO"
- Configure atalhos personalizados

---

## 3.2 Chat Integrado

**Como abrir:**
```r
# No console
gptstudio::chat()

# Ou: Addins ‚Üí GPTSTUDIO ‚Üí ChatGPT Chat
```

**Interface do Chat:**
- Painel lateral direito
- Campo de input na parte inferior
- Hist√≥rico de conversa acima
- Bot√µes para copiar/limpar

**Uso b√°sico:**

```r
# Perguntas gerais
"Como criar um vetor em R?"

# Explicar conceitos
"O que √© um data.frame?"

# Gerar c√≥digo
"Crie uma fun√ß√£o que calcule m√©dia e desvio padr√£o"

# Debugging
"Por que este c√≥digo d√° erro: mean(NA)"
```

**Dicas para bons prompts:**
- Seja espec√≠fico
- D√™ contexto quando necess√°rio
- Pe√ßa explica√ß√µes passo a passo
- Solicite exemplos

---

## 3.3 Explicar C√≥digo Selecionado

**Como usar:**
1. Selecione c√≥digo no editor
2. `Addins ‚Üí GPTSTUDIO ‚Üí Explain Code`
3. Explica√ß√£o aparece no console ou chat

**Exemplo:**

```r
# Selecione este c√≥digo e pe√ßa explica√ß√£o
dados %>%
  filter(!is.na(valor)) %>%
  group_by(categoria) %>%
  summarize(
    n = n(),
    media = mean(valor),
    dp = sd(valor)
  ) %>%
  arrange(desc(media))
```

**O que o ChatGPT explica:**
- O que cada linha faz
- Ordem de execu√ß√£o
- Fun√ß√µes usadas
- Resultado esperado

---

## 3.4 Comentar C√≥digo Automaticamente

**Como usar:**
1. Selecione c√≥digo sem coment√°rios
2. `Addins ‚Üí GPTSTUDIO ‚Üí Comment Code`
3. Coment√°rios s√£o inseridos automaticamente

**Exemplo:**

```{r comentar-codigo}
# ANTES (sem coment√°rios)
calcular_estatisticas <- function(x) {
  x <- x[!is.na(x)]
  list(
    n = length(x),
    media = mean(x),
    mediana = median(x),
    dp = sd(x),
    min = min(x),
    max = max(x)
  )
}

# DEPOIS (com coment√°rios gerados)
# Calcula estat√≠sticas descritivas de um vetor num√©rico
calcular_estatisticas <- function(x) {
  # Remove valores NA do vetor
  x <- x[!is.na(x)]
  
  # Retorna lista com estat√≠sticas b√°sicas
  list(
    n = length(x),           # Tamanho da amostra
    media = mean(x),         # M√©dia aritm√©tica
    mediana = median(x),     # Mediana (valor central)
    dp = sd(x),             # Desvio padr√£o
    min = min(x),           # Valor m√≠nimo
    max = max(x)            # Valor m√°ximo
  )
}
```

---

## 3.5 Chamadas via API Manual (httr2)

Para mais controle e automa√ß√£o, podemos chamar a API diretamente.

**Estrutura b√°sica:**

```{r api-chatgpt-manual}
library(httr2)
library(jsonlite)

# 1. ENDPOINT da API
endpoint <- "https://api.openai.com/v1/chat/completions"

# 2. SEU PROMPT
prompt <- "Explique o que este c√≥digo faz: x <- mean(1:10)"

# 3. CORPO DA REQUISI√á√ÉO (body)
body <- list(
  model = "gpt-4o-mini",  # Modelo a usar
  messages = list(
    list(
      role = "user",       # Quem est√° falando (user/assistant/system)
      content = prompt     # O que est√° dizendo
    )
  ),
  temperature = 0.7,       # Criatividade (0-2, padr√£o 1)
  max_tokens = 500         # M√°ximo de tokens na resposta
)

# 4. CRIAR REQUISI√á√ÉO
req <- request(endpoint) |>
  req_method("POST") |>    # M√©todo HTTP
  req_headers(
    Authorization = paste("Bearer", Sys.getenv("OPENAI_API_KEY")),
    "Content-Type" = "application/json"
  ) |>
  req_body_json(body)      # Corpo em JSON

# 5. EXECUTAR REQUISI√á√ÉO
resp <- req_perform(req)

# 6. EXTRAIR RESPOSTA
json <- resp_body_json(resp)
resposta <- json$choices[[1]]$message$content

# 7. MOSTRAR
cat(resposta)
```

**Par√¢metros importantes:**

- **model**: Qual modelo usar
  - `gpt-4o-mini`: Mais barato, r√°pido
  - `gpt-4o`: Mais inteligente
  - `gpt-4-turbo`: Balanceado

- **temperature**: Criatividade (0-2)
  - `0`: Determin√≠stico, sempre mesma resposta
  - `1` (padr√£o): Balanceado
  - `2`: Muito criativo, imprevis√≠vel

- **max_tokens**: Limite de resposta
  - Controla tamanho e custo
  - ~500 tokens = ~375 palavras

---

## 3.6 Casos de Uso Pr√°ticos com ChatGPT

### Caso 1: Explicar um erro

```{r caso-erro}
# C√≥digo com erro
dados <- data.frame(x = 1:5, y = c(2, 4, NA, 8, 10))
mean(dados$y)  # Retorna NA

# Prompt para ChatGPT:
"Por que mean(dados$y) retorna NA? Como corrigir?"

# ChatGPT explica:
# "mean() retorna NA quando h√° valores ausentes.
#  Solu√ß√£o: use na.rm = TRUE
#  Exemplo: mean(dados$y, na.rm = TRUE)"
```

### Caso 2: Refatorar fun√ß√£o

```{r caso-refatorar}
# Fun√ß√£o verbosa
calcular <- function(x, y) {
  resultado1 <- x + y
  resultado2 <- x * y
  resultado3 <- x / y
  output <- list()
  output$soma <- resultado1
  output$produto <- resultado2
  output$divisao <- resultado3
  return(output)
}

# Prompt:
"Refatore esta fun√ß√£o para ser mais concisa e clara"

# ChatGPT sugere:
calcular <- function(x, y) {
  list(
    soma = x + y,
    produto = x * y,
    divisao = x / y
  )
}
```

### Caso 3: Gerar testes unit√°rios

```{r caso-testes}
# Sua fun√ß√£o
zscore <- function(x) {
  (x - mean(x, na.rm = TRUE)) / sd(x, na.rm = TRUE)
}

# Prompt:
"Gere testes unit√°rios simples para validar esta fun√ß√£o zscore"

# ChatGPT gera:
# Teste 1: vetor normal
teste1 <- zscore(c(1, 2, 3, 4, 5))
stopifnot(abs(mean(teste1)) < 0.0001)  # M√©dia ~0

# Teste 2: vetor com NA
teste2 <- zscore(c(1, NA, 3))
stopifnot(!is.na(teste2[1]))  # Remove NA

# Teste 3: vetor constante
teste3 <- zscore(c(5, 5, 5))
stopifnot(all(is.nan(teste3)))  # sd=0 ‚Üí NaN
```

---

# Parte 4: RStudio + chattr (Claude) (21h00 - 21h30)

## 4.1 Conhecendo o chattr

**chattr** √© uma interface unificada para m√∫ltiplos modelos de IA, incluindo Claude.

**Vantagens:**
- Suporta Claude, ChatGPT, Google Gemini, outros
- Interface simples e consistente
- Chat interativo no console
- F√°cil trocar entre modelos

### Configura√ß√£o inicial

```{r chattr-config}
library(chattr)

# Ver modelos dispon√≠veis
chattr_models()

# Configurar Claude como padr√£o
chattr_defaults(
  provider = "anthropic",
  model = "claude-3-5-sonnet-latest",
  max_tokens = 1000
)

# Verificar configura√ß√£o
chattr_defaults()
```

---

## 4.2 Chat Interativo

**Como usar:**

```{r chattr-uso}
# Iniciar chat no console
chattr()

# Interface interativa aparece
# Digite sua pergunta e Enter
# "Como criar um data.frame em R?"

# Para sair: digite "exit" ou "quit"
```

**Recursos do chat:**
- Hist√≥rico de conversa mantido na sess√£o
- Contexto preservado (lembra conversa anterior)
- Copy/paste de c√≥digo facilmente

---

## 4.3 Chat Program√°tico

```{r chattr-programatico}
# Fazer pergunta diretamente
resposta <- chattr("Como calcular m√©dia em R?")
cat(resposta)

# Com contexto/c√≥digo
codigo <- "
dados <- data.frame(x = 1:5, y = c(2, 4, NA, 8, 10))
mean(dados$y)
"

resposta <- chattr(paste0(
  "Explique o que acontece neste c√≥digo:\n",
  codigo
))
cat(resposta)

# Salvar hist√≥rico
historico <- chattr_history()
print(historico)
```

---

## 4.4 Chamadas via API Manual (Claude)

Para controle total e automa√ß√£o com Claude:

```{r api-claude-manual}
library(httr2)
library(jsonlite)

# 1. ENDPOINT
endpoint <- "https://api.anthropic.com/v1/messages"

# 2. PROMPT
prompt <- "Revise esta fun√ß√£o e torne-a mais robusta a NAs:

soma_media <- function(x) { 
  sum(x) / length(x) 
}"

# 3. CORPO DA REQUISI√á√ÉO
body <- list(
  model = "claude-3-5-sonnet-latest",
  max_tokens = 1000,
  messages = list(
    list(
      role = "user",
      content = prompt
    )
  )
)

# 4. CRIAR REQUISI√á√ÉO
req <- request(endpoint) |>
  req_method("POST") |>
  req_headers(
    Authorization = paste("Bearer", Sys.getenv("ANTHROPIC_API_KEY")),
    "anthropic-version" = "2023-06-01",  # Vers√£o da API
    "content-type" = "application/json"
  ) |>
  req_body_json(body)

# 5. EXECUTAR
resp <- req_perform(req)

# 6. EXTRAIR RESPOSTA
json <- resp_body_json(resp)
resposta <- json$content[[1]]$text

# 7. MOSTRAR
cat(resposta)
```

**Diferen√ßas da API Claude:**

- Header extra: `anthropic-version`
- Estrutura de resposta diferente: `json$content[[1]]$text`
- Sem par√¢metro `temperature` (usa `top_p` e `top_k`)
- `max_tokens` √© obrigat√≥rio

---

## 4.5 Casos de Uso Pr√°ticos com Claude

### Caso 1: An√°lise profunda de c√≥digo

```{r caso-analise}
# C√≥digo complexo para analisar
pipeline_complexo <- "
library(tidyverse)

resultado <- mtcars %>%
  mutate(
    eficiencia = mpg / wt,
    categoria_cyl = case_when(
      cyl <= 4 ~ 'Pequeno',
      cyl <= 6 ~ 'M√©dio',
      TRUE ~ 'Grande'
    )
  ) %>%
  group_by(categoria_cyl, gear) %>%
  summarize(
    n = n(),
    media_ef = mean(eficiencia),
    dp_ef = sd(eficiencia),
    .groups = 'drop'
  ) %>%
  filter(n >= 3) %>%
  arrange(desc(media_ef))
"

# Prompt para Claude:
"Analise este pipeline tidyverse em detalhes:
1. O que cada etapa faz?
2. H√° potenciais problemas ou melhorias?
3. O c√≥digo est√° otimizado?

C√≥digo:
[cole o c√≥digo acima]"

# Claude fornece an√°lise profunda:
# - Explica√ß√£o linha por linha
# - Identifica√ß√£o de poss√≠veis NAs n√£o tratados
# - Sugest√µes de otimiza√ß√£o
# - Alertas sobre edge cases
```

### Caso 2: Gerar fun√ß√£o robusta

```{r caso-funcao-robusta}
# Prompt para Claude:
"Crie uma fun√ß√£o em R que:
1. Receba um data.frame e nome de coluna num√©rica
2. Remova NAs
3. Retorne lista com m√©dia e desvio padr√£o
4. Inclua valida√ß√µes de tipo e mensagens de erro claras
5. Documente com coment√°rios"

# Claude gera:
#' Calcula estat√≠sticas descritivas de uma coluna num√©rica
#'
#' @param df Data frame contendo os dados
#' @param col_name String com nome da coluna num√©rica
#' @return Lista com m√©dia e desvio padr√£o
calcular_stats <- function(df, col_name) {
  # Validar entrada: df deve ser data.frame
  if (!is.data.frame(df)) {
    stop("Erro: 'df' deve ser um data.frame")
  }
  
  # Validar: coluna existe
  if (!col_name %in% names(df)) {
    stop(paste0("Erro: coluna '", col_name, "' n√£o encontrada"))
  }
  
  # Extrair coluna
  coluna <- df[[col_name]]
  
  # Validar: coluna √© num√©rica
  if (!is.numeric(coluna)) {
    stop(paste0("Erro: coluna '", col_name, "' n√£o √© num√©rica"))
  }
  
  # Remover NAs e avisar se houver
  n_nas <- sum(is.na(coluna))
  if (n_nas > 0) {
    message(paste0("Aviso: ", n_nas, " valores NA foram removidos"))
  }
  coluna_limpa <- na.omit(coluna)
  
  # Validar: ainda h√° dados ap√≥s remover NAs
  if (length(coluna_limpa) == 0) {
    stop("Erro: nenhum valor v√°lido ap√≥s remover NAs")
  }
  
  # Calcular estat√≠sticas
  list(
    media = mean(coluna_limpa),
    desvio_padrao = sd(coluna_limpa),
    n_observacoes = length(coluna_limpa),
    n_nas_removidos = n_nas
  )
}

# Teste
dados <- data.frame(x = c(1, 2, NA, 4, 5), y = letters[1:5])
calcular_stats(dados, "x")
```

### Caso 3: Explicar traceback complexo

```{r caso-traceback}
# Erro complexo
erro <- "
Error in mutate(., nova_col = antiga_col * 2) : 
  ‚Ñπ In argument: `nova_col = antiga_col * 2`.
Caused by error:
! object 'antiga_col' not found
Run `rlang::last_trace()` to see where the error occurred.
"

# Prompt para Claude:
"Explique este erro do R e como corrigi-lo:
[cole o erro acima]"

# Claude explica:
# - O que significa cada linha do erro
# - Por que ocorreu (coluna n√£o existe)
# - Como diagnosticar (verificar names(dados))
# - Como corrigir (usar nome correto ou criar coluna)
# - Dicas para evitar no futuro
```

---

# Parte 5: Exerc√≠cio Guiado de Integra√ß√£o (21h30 - 22h00)

## 5.1 Tarefa 1: Revisar c√≥digo com gptstudio

**Objetivo:** Usar ChatGPT para revisar um script tidyverse e propor melhorias.

**C√≥digo para revisar:**

```{r tarefa1-codigo}
# Salve este c√≥digo em: scripts/04_ia_integracao_gptstudio.R

library(tidyverse)
library(palmerpenguins)

# An√°lise de pinguins
dados <- penguins
dados <- dados %>% filter(!is.na(bill_length_mm))
dados <- dados %>% filter(!is.na(bill_depth_mm))
dados <- dados %>% filter(!is.na(flipper_length_mm))
dados <- dados %>% filter(!is.na(body_mass_g))

resultado <- dados %>%
  mutate(bill_ratio = bill_length_mm / bill_depth_mm) %>%
  group_by(species) %>%
  summarize(
    n = n(),
    bill_ratio_mean = mean(bill_ratio),
    bill_ratio_sd = sd(bill_ratio),
    mass_mean = mean(body_mass_g),
    mass_sd = sd(body_mass_g)
  )

print(resultado)
```

**Passos:**

1. Selecione todo o c√≥digo
2. Use gptstudio ‚Üí Explain Code
3. Depois use gptstudio ‚Üí Write Code com prompt:
   "Sugira 2 melhorias para este c√≥digo"

**Melhorias esperadas do ChatGPT:**

```{r tarefa1-melhorado}
# VERS√ÉO MELHORADA
library(tidyverse)
library(palmerpenguins)

# Melhoria 1: Usar drop_na() em vez de m√∫ltiplos filter
# Melhoria 2: Encadear opera√ß√µes em um √∫nico pipeline
resultado <- penguins %>%
  drop_na(bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g) %>%
  mutate(bill_ratio = bill_length_mm / bill_depth_mm) %>%
  group_by(species) %>%
  summarize(
    n = n(),
    across(
      c(bill_ratio, body_mass_g),
      list(mean = mean, sd = sd),
      .names = "{.col}_{.fn}"
    )
  )

print(resultado)
```

---

## 5.2 Tarefa 2: Gerar fun√ß√£o com chattr (Claude)

**Objetivo:** Usar Claude para gerar uma fun√ß√£o robusta.

**Especifica√ß√µes:**
- Receber um data.frame e nome de coluna num√©rica
- Remover NAs
- Retornar m√©dia e desvio-padr√£o com nomes claros
- Incluir valida√ß√£o de tipos e mensagens de erro √∫teis

**Prompt para Claude:**

```{r tarefa2-prompt}
# No console R:
chattr("
Crie uma fun√ß√£o em R chamada 'estatisticas_coluna' que:

1. Receba dois argumentos:
   - df: um data.frame
   - col_name: string com nome da coluna

2. Valide que:
   - df √© um data.frame (se n√£o, erro claro)
   - col_name existe em df (se n√£o, erro claro)
   - A coluna √© num√©rica (se n√£o, erro claro)

3. Remova valores NA e avise quantos foram removidos

4. Retorne uma lista nomeada com:
   - media: m√©dia da coluna
   - desvio_padrao: desvio padr√£o da coluna
   - n_validos: n√∫mero de observa√ß√µes v√°lidas
   - n_nas: n√∫mero de NAs removidos

5. Adicione documenta√ß√£o roxygen2 e coment√°rios

6. Inclua exemplo de uso
")
```

**Salve a resposta em:** `scripts/04_ia_integracao_claude.R`

---

## 5.3 Tarefa 3: Documento de Reflex√£o

**Objetivo:** Documentar o processo e aprendizados.

**Crie:** `docs/relatorio_ia.Rmd`

```{r tarefa3-relatorio}
# Arquivo: docs/relatorio_ia.Rmd
---
title: "Integra√ß√£o de IA no RStudio - Reflex√µes"
author: "Seu Nome"
date: "`r Sys.Date()`"
output: html_document
---

## Tarefa 1: Revis√£o com ChatGPT

**C√≥digo Original:**
[Cole o c√≥digo original aqui]

**Sugest√µes do ChatGPT:**
1. [Descreva a primeira sugest√£o]
2. [Descreva a segunda sugest√£o]

**O que adotei e por qu√™:**
[Explique quais sugest√µes voc√™ implementou e sua justificativa]

**O que n√£o adotei e por qu√™:**
[Se houver, explique o que n√£o usou e por qu√™]

## Tarefa 2: Fun√ß√£o com Claude

**Especifica√ß√µes solicitadas:**
- [Liste as especifica√ß√µes]

**C√≥digo gerado pelo Claude:**
```{r}
# [Cole a fun√ß√£o gerada]
```

**Testes realizados:**
```{r}
# [Cole seus testes]
```

**Avalia√ß√£o:**
- **Pontos positivos:** [O que funcionou bem]
- **Ajustes necess√°rios:** [O que voc√™ teve que modificar]
- **Aprendizados:** [O que voc√™ aprendeu no processo]

## Compara√ß√£o ChatGPT vs Claude

**ChatGPT:**
- Velocidade: [sua observa√ß√£o]
- Qualidade: [sua observa√ß√£o]
- Melhor para: [sua conclus√£o]

**Claude:**
- Velocidade: [sua observa√ß√£o]
- Qualidade: [sua observa√ß√£o]
- Melhor para: [sua conclus√£o]

## Reflex√£o Final

[Escreva um par√°grafo sobre como voc√™ pretende usar IA no seu trabalho com R]
```

---

## 5.4 Checklist Final

Antes de fazer o commit final, verifique:

- [ ] `.Renviron` configurado com ambas as chaves
  ```r
  Sys.getenv("OPENAI_API_KEY")  # Deve mostrar sk-proj-...
  Sys.getenv("ANTHROPIC_API_KEY")  # Deve mostrar sk-ant-...
  ```

- [ ] Pacotes instalados
  ```r
  library(gptstudio)
  library(chattr)
  library(httr2)
  library(jsonlite)
  ```

- [ ] Addins do gptstudio funcionando
  - Addins ‚Üí GPTSTUDIO ‚Üí ChatGPT Chat abre?

- [ ] Chamada m√≠nima via httr2 para cada API funciona
  ```r
  # Teste ChatGPT (simplificado)
  req <- request("https://api.openai.com/v1/chat/completions") |>
    req_method("POST") |>
    req_headers(Authorization = paste("Bearer", Sys.getenv("OPENAI_API_KEY"))) |>
    req_body_json(list(
      model = "gpt-4o-mini",
      messages = list(list(role = "user", content = "Diga ol√°"))
    ))
  resp <- req_perform(req)
  resp_body_json(resp)$choices[[1]]$message$content
  
  # Teste Claude (simplificado)
  req <- request("https://api.anthropic.com/v1/messages") |>
    req_method("POST") |>
    req_headers(
      Authorization = paste("Bearer", Sys.getenv("ANTHROPIC_API_KEY")),
      "anthropic-version" = "2023-06-01",
      "content-type" = "application/json"
    ) |>
    req_body_json(list(
      model = "claude-3-5-sonnet-latest",
      max_tokens = 100,
      messages = list(list(role = "user", content = "Diga ol√°"))
    ))
  resp <- req_perform(req)
  resp_body_json(resp)$content[[1]]$text
  ```

- [ ] Arquivos criados:
  - `scripts/04_ia_integracao_gptstudio.R`
  - `scripts/04_ia_integracao_claude.R`
  - `docs/relatorio_ia.Rmd`

---

## 5.5 Commit e Push

```bash
# Adicionar arquivos
git add scripts/04_*.R docs/relatorio_ia.Rmd

# Commit descritivo
git commit -m "feat: integra√ß√£o ChatGPT e Claude no RStudio (Dia 4)

- Configura APIs OpenAI e Anthropic
- Implementa revis√£o de c√≥digo com gptstudio
- Gera fun√ß√£o robusta com Claude
- Documenta processo e aprendizados"

# Push para seu fork
git push origin main
```

**IMPORTANTE:** N√ÉO fa√ßa commit do arquivo `.Renviron` com suas chaves!

---

# Recursos Adicionais

## Documenta√ß√£o Oficial

**OpenAI:**
- API Reference: https://platform.openai.com/docs/api-reference
- Pricing: https://openai.com/pricing
- Best Practices: https://platform.openai.com/docs/guides/prompt-engineering

**Anthropic:**
- API Reference: https://docs.anthropic.com/claude/reference
- Pricing: https://www.anthropic.com/pricing
- Prompt Engineering: https://docs.anthropic.com/claude/docs/intro-to-prompting

**Pacotes R:**
- gptstudio: https://github.com/MichelNivard/gptstudio
- chattr: https://mlverse.github.io/chattr/
- httr2: https://httr2.r-lib.org/

## Tutoriais e Cursos

- Prompt Engineering Guide: https://www.promptingguide.ai/
- Learn Prompting: https://learnprompting.org/
- OpenAI Cookbook: https://cookbook.openai.com/

## Comunidades

- r/ChatGPT: https://reddit.com/r/ChatGPT
- r/ClaudeAI: https://reddit.com/r/ClaudeAI
- RStudio Community: https://community.rstudio.com/

---

# Troubleshooting

## Erro: API Key inv√°lida

```
Error: 401 Unauthorized
```

**Causas:**
- Chave copiada errada
- Chave expirada
- Chave n√£o configurada corretamente

**Solu√ß√µes:**
1. Verifique: `Sys.getenv("OPENAI_API_KEY")`
2. Recrie chave no dashboard
3. Edite `.Renviron`: `usethis::edit_r_environ()`
4. Reinicie R

## Erro: Rate Limit excedido

```
Error: 429 Too Many Requests
```

**Causa:** Muitas requisi√ß√µes em pouco tempo

**Solu√ß√£o:**
- Espere 1 minuto
- Reduza frequ√™ncia de chamadas
- Use modelo mais barato para testes

## Erro: Insufficient credits

```
Error: 402 Payment Required
```

**Causa:** Cr√©ditos/limite de gastos esgotado

**Solu√ß√£o:**
- Adicione cr√©ditos (OpenAI/Anthropic dashboard)
- Configure limite de gastos
- Verifique m√©todo de pagamento

## gptstudio n√£o aparece nos Addins

**Solu√ß√µes:**
1. Reinstale: `install.packages("gptstudio")`
2. Reinicie RStudio
3. Verifique se instalou corretamente: `library(gptstudio)`

## Problemas de conex√£o

```
Error: Could not resolve host
```

**Solu√ß√µes:**
- Verifique conex√£o com internet
- Teste: `ping api.openai.com`
- Desative VPN se houver
- Configure proxy se necess√°rio

---

# Dicas Finais

## Prompts Eficazes

**Seja espec√≠fico:**
‚ùå "Melhore este c√≥digo"
‚úÖ "Refatore este c√≥digo para usar tidyverse em vez de loops for"

**D√™ contexto:**
‚ùå "Como fazer isso?"
‚úÖ "Tenho um data.frame com colunas x, y, z. Como filtrar linhas onde x > 10 e calcular m√©dia de y por z?"

**Pe√ßa passo a passo:**
‚úÖ "Explique passo a passo como criar um gr√°fico ggplot2 com facetas"

**Solicite valida√ß√µes:**
‚úÖ "Gere esta fun√ß√£o e inclua valida√ß√£o de inputs e tratamento de erros"

## Itera√ß√£o com IA

1. **Primeira tentativa:** Prompt simples
2. **Refinar:** Se n√£o satisfat√≥rio, refine o prompt
3. **Especificar:** Adicione detalhes que faltaram
4. **Validar:** Sempre teste o c√≥digo gerado
5. **Iterar:** Pe√ßa ajustes espec√≠ficos

## Quando N√ÉO usar IA

- ‚ùå C√≥digo com dados sens√≠veis/confidenciais
- ‚ùå Decis√µes cr√≠ticas sem valida√ß√£o
- ‚ùå Substituir documenta√ß√£o oficial
- ‚ùå Aprendizado de conceitos fundamentais (use IA como complemento, n√£o substituto)

## Quando SIM usar IA

- ‚úÖ Entender erros complexos
- ‚úÖ Gerar boilerplate code
- ‚úÖ Refatorar c√≥digo existente
- ‚úÖ Criar testes
- ‚úÖ Documentar c√≥digo
- ‚úÖ Aprender novas fun√ß√µes/pacotes
- ‚úÖ Brainstorming de solu√ß√µes

---

# Conclus√£o do Curso

üéâ **Parab√©ns!** Voc√™ completou o curso de R com GitHub e IA!

## O que voc√™ aprendeu:

**Dia 1:**
- Fundamentos de R (vetores, data.frames, fatores)
- Git e GitHub
- Workflow com fork
- Organiza√ß√£o de projetos

**Dia 2:**
- Operadores e condicionais
- Fun√ß√µes personalizadas
- Tidyverse e dplyr
- Manipula√ß√£o de datas

**Dia 3:**
- Transforma√ß√£o com tidyr
- Tratamento de NAs
- I/O de dados
- Visualiza√ß√£o com ggplot2

**Dia 4:**
- Integra√ß√£o de IA no workflow
- APIs OpenAI e Anthropic
- gptstudio e chattr
- Uso respons√°vel de IA

## Pr√≥ximos passos:

1. **Pratique regularmente** - Consist√™ncia > Intensidade
2. **Trabalhe em projetos reais** - Aplique em seus dados
3. **Participe da comunidade R** - Twitter, Reddit, RStudio Community
4. **Continue aprendendo**:
   - R for Data Science: https://r4ds.hadley.nz/
   - Advanced R: https://adv-r.hadley.nz/
   - TidyTuesday: https://github.com/rfordatascience/tidytuesday

5. **Use IA como assistente** - Mas sempre entenda o c√≥digo!

---

**Obrigado por participar!**

Mantenha contato:
- Email: junqueiravinicius@hotmail.com
- GitHub: https://github.com/viniciusjunqueira/curso-r-github-ia
- LinkedIn: linkedin.com/in/junqueiravinicius

**Bons c√≥digos e boas an√°lises!** üöÄüìä